{% extends "base.html" %}
{% block title %}Explorador do Grafo{% endblock %}

{% block content %}
<section class="page page--graph">
  <header class="page__header">
    <div>
      <h1 class="page__title">Explorador do Grafo</h1>
      <p class="page__subtitle">Visualize relações entre órgãos, empenhos e fornecedores em tempo real.</p>
    </div>
    <div class="actions">
      <select id="data-source" class="select" aria-label="Origem dos dados do grafo">
        <option value="sample">Dados de demonstração</option>
        <option value="random">Dados aleatórios</option>
        <option value="api">API do TCE-RJ</option>
      </select>
      <button id="fit-graph" class="button button--secondary" type="button">Ajustar Visão</button>
    </div>
  </header>

  <section class="graph-filters" aria-label="Filtros do grafo">
    <div class="filter-grid">
      <div class="filter-group">
        <h2 class="filter-title">Tipos de nó</h2>
        <div id="filter-type-list" class="filter-checkbox-list" role="group" aria-label="Tipos de nó"></div>
      </div>

      <div class="filter-group">
        <h2 class="filter-title">Intervalo de valor</h2>
        <div class="filter-range">
          <label for="filter-value-min">Mínimo</label>
          <input type="number" id="filter-value-min" class="filter-input" inputmode="decimal" placeholder="0,00" />
          <label for="filter-value-max">Máximo</label>
          <input type="number" id="filter-value-max" class="filter-input" inputmode="decimal" placeholder="—" />
        </div>
      </div>

      <div class="filter-group">
        <h2 class="filter-title">Busca</h2>
        <input
          type="search"
          id="filter-search"
          class="filter-input"
          placeholder="Nome, número do empenho, documento…"
          aria-label="Buscar por nome, número ou documento"
        />
      </div>

      <div class="filter-group filter-group--compact">
        <label class="filter-checkbox">
          <input type="checkbox" id="filter-anomalies" />
          Somente nós com anomalias
        </label>
        <button id="clear-filters" class="button button--secondary button--sm" type="button">
          Limpar filtros
        </button>
        <span id="filter-summary" class="filter-summary" role="status" aria-live="polite"></span>
      </div>
    </div>
  </section>

  <div class="graph-layout">
    <div class="graph-canvas" id="graph-canvas">
      <div
        class="graph-status graph-status--info"
        id="graph-status"
        role="status"
        aria-live="polite"
        aria-busy="true"
      >
        <div class="graph-status__content">
          <span class="graph-status__loader" aria-hidden="true"></span>
          <p class="graph-status__message">Carregando dados do grafo…</p>
          <div class="graph-status__bar" aria-hidden="true"></div>
        </div>
      </div>
    </div>
    <aside class="graph-sidebar" id="graph-sidebar">
      <h2 class="sidebar__title">Detalhes</h2>
      <div id="sidebar-content" class="sidebar__content">
        <p>Selecione um nó para ver detalhes e conexões.</p>
      </div>
      <div class="legend">
        <h3 class="legend__title">Legenda</h3>
        <ul class="legend__list">
          <li><span class="legend__swatch legend__swatch--orgao"></span>Órgão</li>
          <li><span class="legend__swatch legend__swatch--empenho"></span>Empenho</li>
          <li><span class="legend__swatch legend__swatch--fornecedor"></span>Fornecedor</li>
          <li><span class="legend__swatch legend__swatch--contrato"></span>Contrato</li>
        </ul>
      </div>
    </aside>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js" defer></script>
<script src="{{ url_for('frontend.static', filename='js/graph.js') }}" defer></script>
{% endblock %}
