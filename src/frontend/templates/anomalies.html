{% extends "base.html" %}
{% block title %}Anomalias Detectadas{% endblock %}

{% block content %}
<section class="page">
  <header class="page__header">
    <div>
      <h1 class="page__title">Anomalias Detectadas</h1>
      <p class="page__subtitle">Resultados do pipeline de heurísticas aplicado ao grafo atual.</p>
    </div>
    <div class="actions">
      <button id="refresh-anomalies" class="button" type="button">Atualizar</button>
    </div>
  </header>
  <div class="panel" id="anomalies-panel">
    <div class="panel__body anomaly-layout">
      <div class="anomaly-list-wrapper">
        <div class="ai-inline-actions">
          <div class="ai-box">
            <div class="ai-box__header">
              <h3>Resumo IA</h3>
              <button id="ai-summary-btn" class="button button--secondary button--xs" type="button">Gerar resumo</button>
            </div>
            <div id="anomaly-status" class="panel__status">Carregando anomalias…</div>
            <div id="ai-summary" class="ai-box__body"></div>
          </div>
          <div class="ai-box">
            <div class="ai-box__header">
              <h3>Assistente</h3>
            </div>
            <div class="ai-assistant">
              <textarea id="ai-question" class="input ai-assistant__input" rows="3" placeholder="Pergunte algo: o que é empenho? como priorizar anomalias?"></textarea>
              <button id="ai-ask-btn" class="button button--secondary button--xs" type="button">Perguntar</button>
              <div id="ai-answer" class="ai-box__body"></div>
            </div>
          </div>
        </div>
        <div id="anomaly-stats" class="stat-grid"></div>
        <div id="anomaly-content" class="anomaly-list" hidden></div>
      </div>
      <aside class="anomaly-visualizer" id="anomaly-visualizer">
        <header class="anomaly-visualizer__header">
          <h2 class="anomaly-visualizer__title">Visualização</h2>
          <p id="anomaly-selection-label">Selecione uma anomalia para inspecionar o subgrafo relacionado.</p>
        </header>
        <div id="anomaly-graph" class="anomaly-graph-canvas" aria-live="polite"></div>
        <div id="anomaly-details" class="anomaly-details"></div>
      </aside>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js" defer></script>
<script src="{{ url_for('frontend.static', filename='js/anomalies.js') }}" defer></script>
{% endblock %}
